<script type="text/javascript">
    RED.nodes.registerType('timearray',{
        category: 'Data',
        color: '#878787',
        defaults: {
            plus: {value:0},
            minus: {value:0},
            samples: {value:1},
            currentInclude: {value:""},
            name: {value:""}
        },
        inputs: 1,
        outputs: 1,
        icon: "clock.png",
		paletteLabel: 'Time Array',
        label: function() {
            return this.name || "time array";
        }
    });
</script>

<script type="text/x-red" data-template-name="timearray">
    <div class="form-row" style="margin-left: 100px; width: 70%">
		<label style="width: 70px; margin-right: 10px;" for="node-input-minus"><strong>+/-</strong> Minus</label>
		<input style="width: calc(40% - 120px)" type="number" id="node-input-minus" placeholder="0" min="0">
		<label style="width:30px">mins</label>
		<label style="margin-left: 20%;width: 70px; margin-right: 10px;" for="node-input-plus"><strong>+/-</strong> Plus</label>
		<input style="width: calc(40% - 120px)" type="number" id="node-input-plus" placeholder="0" min="0">
		<label style="width:30px">mins</label>
    </div>
	<div class="form-row">
        <label for="node-input-samples"><i class="icon-tag"></i> Samples</label>
        <input type="number" id="node-input-samples" placeholder="1" min="1">
    </div>
	<div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-currentInclude"><i class="icon-tag"></i>Include current time in array?</label>
        <input type="checkbox" id="node-input-currentInclude" value="on">
    </div>
</script>
<style>
.form-row label {
    vertical-align: middle;
}
textarea{
    width: 70%;
}
select{
    width: 70%;
}
</style>

<script type="text/x-red" data-help-name="timearray">
        
    <!--Main help-->
    <h1 class="titles">Time Array</h1>
        <!--Summary-->
        <h2 class="titles">Summary</h2>
        <p>
    		Takes in a single timestamp, and outputs an array of timestamps surrounding the input timestamp.
        </p>
        <p>
            Let:<br>
            <span class='code'>t=</span><code>msg.payload</code><br>
            <span class='code'>t0=t-Minus</span><br>
            <span class='code'>t1=t+Plus</span><br>

            The array of timestamps takes a number of samples, <code>Samples</code>, between <span class='code'>t0</span> and <span class='code'>t1</span>.
    	</p>
        <hr>

        <!--Inputs-->
        <h2 class="titles">Inputs</h2>
            <h3 class="titles">Default</h3>
                <dl>
                    <!--Single timestamp-->
                    <dt class="io">
                        <p>
                            Timestamp
                                <span class="data-type"> 
                                    number
                                </span>
                        </p>
                    </dt>
                    <dd>
                        <p>
                            <code>msg.payload</code> is the time in milliseconds using the Unix Epoch. This is the default output of the timestamp node.
                        </p>
                    </dd>
                </dl>
        <hr>

        <!--Controls-->
        <h2 class="titles">Controls</h2>
            <h3 class="titles">Limits and density of timings</h3>
                <p>
                    The endpoints of the trajectory are determined by the limits of the timestamps created. The number of timestamp samples taken between these limits determines the resolution of the trajectory to be mapped.
                </p>
                <dl>
                    <!--Minus-->
                    <dt class="io">
                        <p>
                            <span class='code'>Minus</span>
                                <span class="data-type">
                                    number
                                </span>
                        </p>
                    </dt>
                    <dd>
                        <p>
                            The lower limit <span class='code'>t0</span> of the array of timestamps, calculated by taking the <span class='code'>Minus</span> value and taking it away from the inputted timestamp <code>msg.payload</code>.The input is given in minutes.
                         </p>
                    </dd>
                    <!--Plus-->
                    <dt class="io">
                        <p>
                            <span class='code'>Plus</span>
                                <span class="data-type">
                                    number
                                </span>
                        </p>
                    </dt>
                    <dd>
                        <p>
                            The upper limit <span class='code'>t1</span> of the array of timestamps, calculated by taking the <span class='code'>Plus</span> value and adding it to the inputted timestamp <code>msg.payload</code>. The input is given in minutes.
                         </p>
                    </dd>
                    <!--Number of Samples-->
                    <dt class="io">
                        <p>
                            Samples
                                <span class="data-type">
                                    number
                                </span>
                        </p>
                    </dt>
                    <dd>
                        <p>
                            The number of samples taken between the lower limit <span class='code'>t0</span> and the upper limit <span class='code'>t1</span>.
                         </p>
                    </dd>
                    <!--currentInclude-->
                    <dt class="io-optional">
                        <p>
                            Include current time in array?
                                <span class="data-type">
                                    string
                                </span>
                        </p>
                    </dt>
                    <dd>
                        <p>
                            Checking this box changes the functionality of the node to guarantee that the number of samples are distributed over the intervals <span class='code'>t0 <--> t</span> and <span class='code'>t <--> t1</span>, in proportion to the size of these intervals. The <code>currenttime</code> timestamp will be included. The difference between consecutive timestamps may not be the same across the entire data set.
                         </p>
                    </dd>
                </dl>
        <hr>

        <!--Outputs-->
        <h2 class="titles">Output</h2>
            <p>
                <code>msg.payload</code> is an object, with two properties: <code>currenttime</code> and <code>times</code>
            </p>
            <h3 class="titles">Properties</h3>
                <dl>
                    <!--currentime-->
                    <dt class="io">
                        <p>
                            <code>currenttime</code>
                                <span class="data-type"> 
                                    number
                                </span>
                        </p>
                    </dt>
                    <dd>
                        <p>
                            The inputted timestamp, representing the current time <span class='code'>t</span>.
                        </p>
                    </dd>

                    <!--times-->
                    <dt class="io">
                        <p>
                            <code>times</code>
                                <span class="data-type"> 
                                    array
                                </span>
                        </p>
                    </dt>
                    <dd>
                        <p>
                            <code>times</code> is an array having length <code>samples</code>, comprising timestamps ranging from <span class='code'>t0</span> to <span class='code'>t1</span>. 

                            If the checkbox 'Include current timestamp in array?' is checked, then the functionality of the node is forced to include the current time <span class='code'>t</span> in the array. Otherwise, the array may or may not be included, depending on whether the number of samples suitbaly divides the interval <span class='code'>t0 <--> t1</span>.
                        </p>
                    </dd>
                </dl>
</script>
<style>
    h1.titles, h2.titles{
        line-height:20px;
    }
    h3.titles{
        line-height:20px;
        font-weight:bold;   
    }
    dt.io{
        color: #AD1625;
        font-weight: bold;

    }
    dt.io-optional{
        color: #AD1625;
        font-weight: bold;
        font-style: italic;

    }
    span.data-type{
        float: right;
        font-style: italic;
        font-weight: lighter;
        font-size: 11px;
        color: #666;
    }
    span.code{
        font-family: "Courier New", Monospace;
    }
</style>
<!--
The output of this node is an object comprising the properities:
            <code>currenttime</code>, which is the original input timestamp;
            <br>
            

            -->